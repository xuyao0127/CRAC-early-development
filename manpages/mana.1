.\" Automatically generated by Pandoc 2.9.2.1
.\"
.TH "MANA" "1" "31 March 2022" "" ""
.hy
.SH NAME
.PP
\f[B]mana\f[R] \[en] MANA family of commands for checkpointing MPI jobs
.SH SYNOPSIS
.PP
\f[B]mana_launch\f[R] [--help] [--verbose] [--timing] [DMTCP_OPTIONS]
[--ckptdir \f[I]DIR\f[R]] COMMAND [\f[I]ARGS\&...\f[R]]
.PD 0
.P
.PD
\f[B]mana_coordinator\f[R] [--help] [--verbose]
[\f[I]DMTCP_OPTIONS\f[R]]
.PD 0
.P
.PD
\f[B]mana_start_coordinator\f[R]
.PD 0
.P
.PD
\f[B]mana_status\f[R] [--help] [--verbose] [\f[I]DMTCP_OPTIONS\f[R]]
.PD 0
.P
.PD
\f[B]mana_restart\f[R] [--help] [--verbose] [\f[I]DMTCP_OPTIONS\f[R]]
[--restartdir \f[I]DIR\f[R]]
.SH DESCRIPTION
.PP
\f[B]MANA\f[R] is a package that enables checkpoint-restart for MPI
jobs.
The name MANA stands for \[lq]MPI-Agnostic Network-Agnostic
Checkpointing\[rq].
It is designed to be compatible with most MPI implementations and most
underlying networks.
MANA is built on top of the DMTCP checkpointing package.
.SH COMMAND LINE OPTIONS
.TP
\f[B]\f[R]\f[C]--help\f[R]\f[B]\f[R]
Show additional DMTCP_OPTIONS for a MANA command.
.TP
\f[B]\f[R]\f[C]--verbose\f[R]\f[B]\f[R]
Display the underlying DMTCP command and DMTCP_OPTIONS used, and other
info.
.TP
\f[B]\f[R]\f[C]--timing\f[R]\f[B]\f[R]
Print times to stderr for INIT, EXIT, and ckkpt-restart events.
(stays active during both mana_launch and mana_restart)
.SH MANA PROGRAM EXECUTION
.PP
Execute a MANA command with \f[C]--help\f[R] for a usage statement.
.PP
Checkpoints may be invoked:
.TP
\f[B]\f[R]\f[C]periodically\f[R]\f[B]\f[R]
via the \f[C]--interval\f[R] or \f[C]-i\f[R] flag (units in seconds)
.TP
\f[B]\f[R]\f[C]under program control\f[R]\f[B]\f[R]
(see \f[C]dmtcp/test/plugin/applic-initiated-ckpt\f[R] directory)
.TP
\f[B]\f[R]\f[C]externally\f[R]\f[B]\f[R]
via \f[C]mana_status --checkpoint\f[R]
.PP
A typical workflow for using MANA after untar\[aq]ing is:
.IP
.nf
\f[C]
cd dmtcp-mana
\&./configure --enable-debug
make -j mana
# Compile against libmana.so: Examples at contrib/mpi-proxy-split/test
salloc -N 2 -q interactive -C haswell -t 01:00:00
bin/mana_coordinator -i10
srun -N 2 bin/mana_launch <TARGET_DIR>/ping_pong.mana.exe
bin/mana_coordinator -i10
srun -N 2 bin/mana_restart
\f[R]
.fi
.PP
MANA supports most features of DMTCP, including:
.IP \[bu] 2
plugins to extend the functionality of DMTCP
.IP \[bu] 2
virtualization of pathname prefixes (plugin/pathvirt)
.IP \[bu] 2
modification of environment variables at restart (plugin/modify-env)
.IP \[bu] 2
distinct checkpoint filenames
(\f[C]dmtcp_launch --enable-unique-checkpoint-filenames\f[R]).
The default is to overwrite the last checkpoint.
.SH ENVIRONMENT VARIABLES AND DEBUGGING
.TP
\f[B]\f[R]\f[C]MANA_DEBUG\f[R]\f[B]\f[R]
MANA will print to stderr extra information to help developers debug
MANA.
.TP
\f[B]\f[R]\f[C]DMTCP_MANA_PAUSE\f[R]\f[B] or \f[R]\f[C]DMTCP_LAUNCH_PAUSE\f[R]\f[B]\f[R]
DMTCP/MANA will pause during launch to allow \f[C]gdb attach\f[R] (GDB
must be on same node.)
.TP
\f[B]\f[R]\f[C]DMTCP_MANA_PAUSE\f[R]\f[B]\f[R]
DMTCP/MANA will pause very early in restart, inside
\f[C]mtcp/mtcp_restart.c\f[R] shortly before calling
\f[C]splitProcess()\f[R] (intended for developers)
.TP
\f[B]\f[R]\f[C]DMTCP_RESTART_PAUSE\f[R]\f[B]\f[R]
DMTCP/MANA will pause during restart, before resuming execution, to
allow \f[C]gdb attach\f[R] (GDB must be on same node.)
.TP
\f[B]\f[R]\f[C]MPI_COLLECTIVE_P2P\f[R]\f[B]\f[R]
\f[B]For debugging only (high runtime overhead)\f[R]: If this env.
var.
is set, and if re-building any files in
\f[C]mpi-proxy-split/mpi-wrappers\f[R], then MPI collective
communication calls are translated to MPI_Send/Recv at runtime.
(Try \f[C]touch mpi_collective_p2p.c\f[R] if not re-building.)
.PD 0
.P
.PD
.PP
NOTE: You can select specific collective calls for translation to
MPI_Send/Recv by copying MPI wrappers from mpi_collective_p2p.c to
mpi_collective_wrappers.cpp in the mpi-wrappers subdirectory; or block
certain translations by adjusting
\f[C]#ifdef/#ifndef MPI_COLLECTIVE_P2P\f[R] in those files.
.TP
\f[B]\f[R]\f[C]MANA_P2P_LOG\f[R]\f[B]\[dq]\f[R]
For debugging: Set this before mana_launch in order to log the order of
point-to-point calls (MPI_Send and family) for later deterministic
replay.
See details at top of
\f[C]mpi-proxy-split/mpi-wrappers/p2p-deterministic.c\f[R].
.PP
(IMPORTANT: If you checkpoint, continue running for a few minutes after
that, for final updating of the log files.)
.TP
\f[B]\f[R]\f[C]MANA_P2P_REPLAY\f[R]\f[B]\f[R]
For debugging: If a checkpoint was created with \f[C]MANA_P2P_LOG\f[R],
then execute \f[C]mana_p2p_update_logs\f[R] and set this variable before
\f[C]mana_restart\f[R].
(Currently, you need to set this before \f[C]mana_launch\f[R], but this
may be fixed later.)
.PP
\f[B]\f[CB]MANA_USE_ALLREDUCE_REPRODUCIBLE\f[B]\f[R]
.PP
When MPI_Allreduce specifies an associative/commutative operation, the
MPI library must choose an ordering of the operation during reduce.
The ordering may vary when calling MPI_Allreqduce after launch or after
replay.
By setting the environment variable MANA_USE_ALLREDUCE_REPRODUCIBLE at
the time of launch, you can direct MANA to call the operations in a
deterministic order, so that the output after checkpoint-restart will
produce the same output as running after launch with no
checkpoint-restart.
.PP
\f[B]\f[CB]INSPECTING MANA for DEBUGGING\f[B]\f[R]
.PP
To see status of ranks (especially during checkpoint), try:
.IP
.nf
\f[C]
bin/mana_status --list
\f[R]
.fi
.PP
To inspect a checkpoint image from, for example, Rank \f[C]0\f[R], try:
.IP
.nf
\f[C]
util/readdmtcp.sh ckpt_rank0/ckpt_*.dmtcp
\f[R]
.fi
.PP
To debug during restart at stage `N', replace `N' Below, and execute:
.IP
.nf
\f[C]
srun ... env DMTCP\[rs]_RESTART\[rs]_PAUSE=N mana\[rs]_restart ... APPLICATION &
gdb -p APPLICATION PID  # from a different terminal
\f[R]
.fi
.PP
To see the stack, you then may or may not need to try some of the
following:
.IP
.nf
\f[C]
(gdb) source util/gdb-dmtcp-utils
(gdb) load-symbol-library ADDRESS-OR-LIBRARY-SUBSTRING
(gdb) dmtcp  # to see other available commands
\f[R]
.fi
.PP
If you are debugging the lower half internals of MANA, you may need:
.IP
.nf
\f[C]
(gdb) file bin/lh_proxy
\f[R]
.fi
.PP
If debugging the low-level restart process, please read
restart/plugin/README.
.SH BUGS
.PP
Report bugs in MANA to: https://github.com/mpickpt/mana
.SH SEE ALSO
.PP
\f[B]MANA home page:\f[R] <https://github.com/mpickpt/mana>,
.PD 0
.P
.PD
\f[B]dmtcp\f[R](1), \f[B]dmtcp_coordinator\f[R](1),
\f[B]dmtcp_launch\f[R](1),
.PD 0
.P
.PD
\f[B]dmtcp_restart\f[R](1), \f[B]dmtcp_command\f[R](1)
